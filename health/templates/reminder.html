<!DOCTYPE html>
<html>
<head>
<title>Smart Medicine Reminder</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

/* üåà Background */
body{
    margin:0;
    height:100vh;
    background: linear-gradient(135deg,#667eea,#764ba2);
    display:flex;
    justify-content:center;
    align-items:center;
    font-family: 'Segoe UI', sans-serif;
    overflow:hidden;
}

/* Blur overlay */
.overlay{
    position:absolute;
    width:100%;
    height:100%;
    backdrop-filter: blur(8px);
}

/* üíé Glass Card */
.reminder-card{
    position:relative;
    background: rgba(255,255,255,0.15);
    border-radius:25px;
    padding:40px;
    width:380px;
    text-align:center;
    color:white;
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
    backdrop-filter: blur(15px);
    animation: popup 0.6s ease;
}

@keyframes popup{
    from{transform:scale(0.7);opacity:0;}
    to{transform:scale(1);opacity:1;}
}

/* ‚è∞ Alarm Icon Animation */
.alarm-icon{
    font-size:60px;
    animation: ring 1s infinite;
}

@keyframes ring{
    0%{transform:rotate(0);}
    25%{transform:rotate(15deg);}
    50%{transform:rotate(-15deg);}
    75%{transform:rotate(10deg);}
    100%{transform:rotate(0);}
}

/* Buttons */
.btn-custom{
    border:none;
    border-radius:30px;
    padding:10px 20px;
    margin:8px;
    font-weight:600;
}

.stop{background:#ff4d4d;color:white;}
.taken{background:#00c851;color:white;}
.snooze{background:#ffc107;color:black;}

.progress{
    height:10px;
    border-radius:20px;
    margin-top:20px;
}

</style>
</head>

<body>

<div class="overlay"></div>

<div class="reminder-card">

<div class="alarm-icon">‚è∞</div>

<h3 class="mt-3 text-danger">Time to Take Medicine!</h3>

<hr style="border-color:white;">

<h5>üíä {{ med.name }}</h5>
<p>Dosage: {{ med.dosage }}</p>
<p>Time: {{ med.time }}</p>

<!-- Progress Bar -->
<div class="progress">
  <div id="progressBar"
       class="progress-bar progress-bar-striped progress-bar-animated"
       style="width:100%">
  </div>
</div>

<!-- Buttons -->
<div class="mt-4">

<button class="btn btn-custom stop"
        onclick="stopAlarm()">
üîï Stop
</button>

<button class="btn btn-custom snooze"
        onclick="snoozeAlarm()">
üò¥ Snooze 5 min
</button>

<a href="{% url 'mark_taken' med.id %}">
<button class="btn btn-custom taken">
‚úî Mark Taken
</button>
</a>

</div>

</div>

<!-- üîî Alarm Sound -->
<audio id="alarmSound" autoplay loop>
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>

var alarm = document.getElementById("alarmSound");

/* üîä Voice Reminder */
var speech = new SpeechSynthesisUtterance(
    "Reminder. Time to take {{ med.name }}. Dosage {{ med.dosage }}"
);
speech.lang = "en-US";
window.speechSynthesis.speak(speech);

/* üîï Stop Alarm */
function stopAlarm(){
    alarm.pause();
    alarm.currentTime = 0;
}

/* üò¥ Snooze 5 Minutes */
function snoozeAlarm(){

    stopAlarm();

    alert("Snoozed for 5 minutes üò¥");

    setTimeout(()=>{
        alarm.play();
        window.speechSynthesis.speak(speech);
    }, 300000); // 5 min
}

/* ‚è≥ Auto Close Progress (60 sec) */

var timeLeft = 60;
var bar = document.getElementById("progressBar");

var timer = setInterval(()=>{

    timeLeft--;
    bar.style.width = timeLeft + "%";

    if(timeLeft <= 0){
        clearInterval(timer);
        window.close(); // auto close
    }

},1000);

</script>
<audio id="alarmSound" autoplay loop>
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>
    var alarm = document.getElementById("alarmSound");

    window.onload = function() {
        alarm.play();
    }

    function stopAlarm() {
        alarm.pause();
        alarm.currentTime = 0;
    }
</script>


</body>
</html>
