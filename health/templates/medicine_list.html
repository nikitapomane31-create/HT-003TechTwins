<!DOCTYPE html>
<html>
<head>
<title>Smart Medicine Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

/* ğŸŒˆ Background */
body{
    background: linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;
    font-family:'Segoe UI',sans-serif;
    color:white;
}

/* Navbar */
.navbar{
    background: rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
}

/* Glass Cards */
.med-card{
    background: rgba(255,255,255,0.15);
    border-radius:20px;
    padding:20px;
    backdrop-filter: blur(15px);
    box-shadow:0 8px 25px rgba(0,0,0,0.3);
    transition:0.3s;
}

.med-card:hover{
    transform:scale(1.03);
}

/* Badge */
.badge-taken{
    background:#00c851;
}

.badge-pending{
    background:#ffbb33;
}

/* Buttons */
.btn-custom{
    border-radius:30px;
    padding:5px 15px;
    font-size:14px;
}

.search-box{
    border-radius:30px;
    padding:10px 20px;
    border:none;
}

</style>
</head>

<body>

<!-- ğŸŒ Navbar -->
<nav class="navbar navbar-dark p-3">
<div class="container-fluid">
<h4>ğŸ’Š Smart Medicine Reminder</h4>

<a href="{% url 'add_medicine' %}"
   class="btn btn-light btn-custom">
â• Add Medicine
</a>
</div>
</nav>

<div class="container mt-4">

<!-- ğŸ” Search -->
<input type="text"
       id="searchInput"
       class="form-control search-box mb-4"
       placeholder="Search medicine...">

<div class="row" id="medicineContainer">

{% for med in medicines %}

<div class="col-md-4 mb-4 medicine-item">

<div class="med-card text-center"
     id="card-{{ med.id }}">

<h5>ğŸ’Š {{ med.name }}</h5>

<p>Dosage: {{ med.dosage }}</p>

<p class="med-time"
   data-id="{{ med.id }}">
â° {{ med.time|time:"H:i" }}
</p>

<!-- Status -->
{% if med.taken %}
<span class="badge badge-taken">
âœ” Taken
</span>
{% else %}
<span class="badge badge-pending">
Pending
</span>
{% endif %}

<hr style="border-color:white;">

<!-- Buttons -->
<a href="{% url 'edit_medicine' med.id %}"
   class="btn btn-warning btn-sm btn-custom">
âœ Edit
</a>

<a href="{% url 'delete_medicine' med.id %}"
   class="btn btn-danger btn-sm btn-custom">
ğŸ—‘ Delete
</a>

</div>
</div>

{% empty %}
<p>No medicines added yet.</p>
{% endfor %}

</div>
</div>

<!-- ğŸ”” Alarm Sound -->
<audio id="alarmSound">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>

/* ğŸ” Search Filter */
document.getElementById("searchInput")
.addEventListener("keyup", function(){

    var value = this.value.toLowerCase();
    var items = document.querySelectorAll(".medicine-item");

    items.forEach(function(item){
        item.style.display =
        item.innerText.toLowerCase().includes(value)
        ? "block" : "none";
    });
});


/* â° Reminder Checker */

function checkReminder(){

    var now = new Date();

    var current =
        now.getHours().toString().padStart(2,'0') + ":" +
        now.getMinutes().toString().padStart(2,'0');

    var times =
        document.querySelectorAll(".med-time");

    times.forEach(function(t){

        var medTime =
            t.innerText.replace("â°","").trim();

        if(medTime === current){

            var id = t.getAttribute("data-id");

            // ğŸ”¥ Redirect to Reminder Popup
            window.location.href =
            "/medi/reminder/" + id + "/";
        }

    });

}

/* Check every 30 sec */
setInterval(checkReminder, 30000);

</script>

</body>
</html>
